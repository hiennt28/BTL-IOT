<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Quản lý</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="assets/css/style.css">
<style>
/* Style đồng bộ với patient/doctor */
body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5;}
.sidebar {width: 250px; position: fixed; top:0; left:0; height:100%; background:#212529; padding-top:20px; transition: all 0.3s; z-index: 1000;}
.sidebar .nav-link {color:rgba(255,255,255,0.75); display:flex; align-items:center; padding:12px 25px; margin-bottom: 5px; border-radius: 0 25px 25px 0; margin-right: 10px;}
.sidebar .nav-link:hover {color: #fff; background: rgba(255,255,255,0.1);}
.sidebar .nav-link.active {background:#0d6efd; color: white; box-shadow: 2px 2px 5px rgba(0,0,0,0.2);}
.sidebar .nav-link i { margin-right: 10px; font-size: 1.1rem; }

.content {margin-left:250px; padding:30px; min-height: 100vh;}

.card {border: none; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); background: white; margin-bottom: 20px; transition: transform 0.2s;}
.card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
.card-header { background: transparent; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 15px 20px; font-weight: 600; color: #495057; }

.user-profile { text-align: center; padding: 20px 15px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
.user-profile img { width: 90px; height: 90px; border-radius: 50%; background: #fff; padding: 3px; margin-bottom: 15px; object-fit: cover;}
.user-profile h5 { color: #fff; font-weight: 600; font-size: 1.1rem; margin-bottom: 5px; }
.user-profile p { color: #adb5bd; font-size: 0.9rem; margin-bottom: 0; text-transform: capitalize; }

.stat-value { font-size: 2rem; font-weight: 700; margin-top: 5px; }
.stat-label { font-size: 0.9rem; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; }
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <div class="user-profile">
        <!-- Avatar Manager -->
        <img src="https://cdn-icons-png.flaticon.com/512/2206/2206368.png" alt="Avatar"> 
        <h5 id="userProfileName">Đang tải...</h5>
        <p id="userProfileRole">Quản lý</p>
    </div>

    <a href="#" class="nav-link active" data-tab="doctors"><i class="bi bi-briefcase-fill"></i> Quản lý bác sĩ</a>
    <a href="#" class="nav-link" data-tab="patients"><i class="bi bi-people-fill"></i> Quản lý bệnh nhân</a>
    <a href="#" class="nav-link" data-tab="devices"><i class="bi bi-hdd-network-fill"></i> Quản lý thiết bị</a>
    <a href="#" class="nav-link" data-tab="firmware"><i class="bi bi-arrow-repeat"></i> Cập nhật Firmware</a>

    <!-- <a href="#" class="nav-link" data-tab="devices"><i class="bi bi-hdd-network-fill"></i> Giám sát hệ thống</a> -->
    <a href="#" class="nav-link" data-tab="reports"><i class="bi bi-bar-chart-fill"></i> Thống kê & báo cáo</a>
    
    <div style="margin-top: auto; padding: 20px;">
        <button id="logoutBtn" class="btn btn-outline-light w-100"><i class="bi bi-box-arrow-right"></i> Đăng xuất</button>
    </div>
</div>

<div class="content">

    <!-- TAB: QUẢN LÝ BÁC SĨ -->
    <div id="tab-doctors" class="tab-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark mb-0">Danh sách bác sĩ</h3>
            <button class="btn btn-success shadow-sm" id="addDoctorBtn">
                <i class="bi bi-person-plus-fill me-2"></i>Thêm bác sĩ
            </button>
        </div>

        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">#</th>
                                <th>Họ và tên</th>
                                <th>Email</th>
                                <th>Điện thoại</th>
                                <th>Chức danh</th>
                                <th class="text-center">Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="doctors-table-body">
                            <!-- JS sẽ điền dữ liệu vào đây -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: QUẢN LÝ BỆNH NHÂN -->
    <div id="tab-patients" class="tab-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark mb-0">Danh sách bệnh nhân</h3>
            <button class="btn btn-success shadow-sm" id="addPatientBtn">
                <i class="bi bi-person-plus-fill me-2"></i>Thêm bệnh nhân
            </button>
        </div>
        
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">#</th>
                                <th>Họ và tên</th>
                                <th>Email</th>
                                <th>Bác sĩ phụ trách</th>
                                 <th>Thiết bị</th> <!-- mới -->
                            <th class="text-center">Hành động</th> 
                            
                            </tr>
                        </thead>
                        <tbody id="patients-table-body">
                            <!-- JS sẽ điền dữ liệu vào đây -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
<!-- MODAL GÁN THIẾT BỊ CHO BỆNH NHÂN -->
<div class="modal fade" id="assignDeviceModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assignDeviceModalTitle">Gán thiết bị cho bệnh nhân</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="assignDeviceForm">
          <input type="hidden" id="assignPatientId">
          <div class="mb-3">
            <label class="form-label">Chọn thiết bị</label>
            <select class="form-select" id="assignDeviceSelect">
              <!-- JS sẽ load các thiết bị chưa gán vào đây -->
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" id="saveAssignDeviceBtn">Gán thiết bị</button>
      </div>
    </div>
  </div>
</div>

<!-- TAB: QUẢN LÝ THIẾT BỊ -->
<div id="tab-devices" class="tab-content d-none">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-dark mb-0">Quản lý thiết bị IoT</h3>
        <button class="btn btn-success shadow-sm" id="addDeviceBtn">
            <i class="bi bi-plus-circle me-2"></i>Thêm thiết bị
        </button>
    </div>

    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="ps-4">#</th>
                            <th>Serial thiết bị</th>
                            <th>Trạng thái</th>
                            <th>Cập nhật lần cuối</th>
                            <th class="text-center">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="devices-table-body">
                        <!-- JS sẽ điền dữ liệu vào đây -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- MODAL THÊM / SỬA THIẾT BỊ -->
<div class="modal fade" id="deviceModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deviceModalTitle">Thêm thiết bị</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="deviceForm">
          <div class="mb-3">
            <label class="form-label">Serial thiết bị</label>
            <input type="text" class="form-control" id="modalDeviceSerial" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" id="saveDeviceBtn">Lưu</button>
      </div>
    </div>
  </div>
</div>



    <!-- TAB: THỐNG KÊ & BÁO CÁO -->
    <div id="tab-reports" class="tab-content d-none">
        <h3 class="mb-4 fw-bold text-dark">Tổng quan hệ thống</h3>
        
        <div class="row g-4 mb-4">
            <div class="col-md-6">
                <div class="card h-100 border-start border-4 border-primary">
                    <div class="card-body d-flex align-items-center justify-content-between p-4">
                        <div>
                            <div class="stat-label">Tổng số Bệnh nhân</div>
                            <div class="stat-value text-primary" id="total-patients">0</div>
                        </div>
                        <i class="bi bi-people fs-1 text-primary opacity-25"></i>
                    </div>
                </div>
            </div>
             <div class="col-md-6">
                <div class="card h-100 border-start border-4 border-success">
                    <div class="card-body d-flex align-items-center justify-content-between p-4">
                        <div>
                            <div class="stat-label">Tổng số Bác sĩ</div>
                            <div class="stat-value text-success" id="total-doctors">0</div>
                        </div>
                        <i class="bi bi-briefcase fs-1 text-success opacity-25"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-8">
                 <div class="card h-100">
                     <div class="card-header border-0 bg-transparent">
                         <i class="bi bi-pie-chart-fill me-2 text-danger"></i>Thống kê loại cảnh báo
                     </div>
                     <div class="card-body d-flex justify-content-center">
                         <div style="width: 300px; height: 300px;">
                            <canvas id="alertsChart"></canvas>
                         </div>
                     </div>
                 </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 bg-primary text-white">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                        <i class="bi bi-shield-check fs-1 mb-3"></i>
                        <h4>Hệ thống ổn định</h4>
                        <p class="mb-0 opacity-75">Tất cả dịch vụ đang hoạt động bình thường.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- MODAL THÊM/SỬA BÁC SĨ -->
<div class="modal fade" id="doctorModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="doctorModalTitle">Thêm bác sĩ</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
          <form id="doctorForm">
              <div id="doctorMsg" class="alert d-none"></div>
              <input type="hidden" id="modalDoctorId">
              <div class="mb-3"><label class="form-label">Họ và tên</label><input type="text" class="form-control" id="modalDocFullName" required></div>
              <div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="modalDocEmail" required></div>
              <div class="mb-3" id="password-field"><label class="form-label">Mật khẩu</label><input type="password" class="form-control" id="modalDocPassword" required></div>
              <div class="mb-3"><label class="form-label">Số điện thoại</label><input type="text" class="form-control" id="modalDocPhone"></div>
              <div class="mb-3"><label class="form-label">Địa chỉ</label><input type="text" class="form-control" id="modalDocAddress"></div>
              <div class="mb-3"><label class="form-label">Ngày sinh</label><input type="date" class="form-control" id="modalDocDOB"></div>
              <div class="row">
                  <div class="col-md-6 mb-3"><label class="form-label">Chức danh</label><input type="text" class="form-control" id="modalDocTitle"></div>
                  <div class="col-md-6 mb-3"><label class="form-label">Chuyên khoa</label><input type="text" class="form-control" id="modalDocSpecialty"></div>
              </div>
          </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" id="saveDoctorBtn">Lưu thông tin</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL THÊM BỆNH NHÂN -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Thêm bệnh nhân mới</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
          <form id="patientForm">
              <div id="patientMsg" class="alert d-none"></div>
              <div class="mb-3"><label class="form-label">Họ và tên</label><input type="text" class="form-control" id="modalPatientFullName" required></div>
              <div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="modalPatientEmail" required></div>
              <div class="mb-3"><label class="form-label">Mật khẩu</label><input type="password" class="form-control" id="modalPatientPassword" required></div>
              <div class="mb-3"><label class="form-label">Số điện thoại</label><input type="text" class="form-control" id="modalPatientPhone"></div>
              <div class="mb-3"><label class="form-label">Địa chỉ</label><input type="text" class="form-control" id="modalPatientAddress"></div>
              <div class="mb-3"><label class="form-label">Ngày sinh</label><input type="date" class="form-control" id="modalPatientDOB"></div>
          </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" id="savePatientBtn">Lưu thông tin</button>
      </div>
    </div>
  </div>
</div>

<!-- TAB: CẬP NHẬT FIRMWARE  -->
<div id="tab-firmware" class="tab-content d-none" style="padding-left :250px;">

    <div class="container-fluid px-0">

        <!-- TIÊU ĐỀ CĂN GIỮA -->
        <h3 class="fw-bold text-dark mb-4 text-center">
            <i class="bi bi-arrow-repeat text-primary"></i> Cập nhật Firmware
        </h3>

        <!-- BAO TOÀN BỘ NỘI DUNG ĐỂ LÙI SANG TRÁI -->
        <div class="card border-0 shadow-sm rounded-4 ms-0">

            <div class="card-body p-4">

                <div class="row g-4">

                    <!-- LEFT -->
                    <div class="col-lg-6">
                        <div class="p-4 border rounded-4 bg-light">

                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-cpu text-primary"></i> Chọn thiết bị
                            </h5>

                            <select class="form-select form-select-lg mb-4" id="firmwareDeviceSelect">
                                <option value="">— Chọn thiết bị —</option>
                            </select>

                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-upload text-success"></i> Chọn file firmware (.bin)
                            </h5>

                            <input type="file" id="firmwareFileInput" class="form-control" accept=".bin">

                            <div id="selectedFileName" class="mt-2 text-primary d-none fw-semibold"></div>
                        </div>
                    </div>

                    <!-- RIGHT -->
                    <div class="col-lg-6">
                        <div class="p-4 border rounded-4 bg-light">

                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-activity text-danger"></i> Trạng thái cập nhật
                            </h5>

                            <div id="firmwareStatusBox"
                                 class="border rounded-4 p-3 bg-white text-center text-muted fw-semibold">
                                Chưa bắt đầu
                            </div>

                            <div class="progress mt-4" style="height: 20px;">
                                <div id="firmwareProgress"
                                     class="progress-bar progress-bar-striped progress-bar-animated"
                                     style="width: 0%"></div>
                            </div>

                            <button id="startFirmwareUpdateBtn"
                                class="btn btn-primary btn-lg w-100 mt-4 rounded-pill shadow-sm">
                                <i class="bi bi-arrow-clockwise me-2"></i> Bắt đầu cập nhật
                            </button>

                            <div class="alert alert-warning mt-4 rounded-3">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                Không tắt nguồn thiết bị trong khi cập nhật.
                            </div>

                        </div>
                    </div>

                </div>

            </div>
        </div>

    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Gọi file JS riêng cho manager -->
<script src="assets/js/manager.js"></script>

</body>
</html>