<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Bác sĩ</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="assets/css/style.css">
<style>
/* Copy style chuẩn từ patient.html sang để đồng bộ */
body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5;}
.sidebar {width: 250px; position: fixed; top:0; left:0; height:100%; background:#212529; padding-top:20px; transition: all 0.3s; z-index: 1000;}
.sidebar .nav-link {color:rgba(255,255,255,0.75); display:flex; align-items:center; padding:12px 25px; margin-bottom: 5px; border-radius: 0 25px 25px 0; margin-right: 10px;}
.sidebar .nav-link:hover {color: #fff; background: rgba(255,255,255,0.1);}
.sidebar .nav-link.active {background:#0d6efd; color: white; box-shadow: 2px 2px 5px rgba(0,0,0,0.2);}
.sidebar .nav-link i { margin-right: 10px; font-size: 1.1rem; }

.content {margin-left:250px; padding:30px; min-height: 100vh;}

.card {border: none; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); background: white; margin-bottom: 20px; transition: transform 0.2s;}
.card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
.card-header { background: transparent; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 15px 20px; font-weight: 600; color: #495057; }

.user-profile { text-align: center; padding: 20px 15px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
.user-profile img { width: 90px; height: 90px; border-radius: 50%; background: #fff; padding: 3px; margin-bottom: 15px; object-fit: cover;}
.user-profile h5 { color: #fff; font-weight: 600; font-size: 1.1rem; margin-bottom: 5px; }
.user-profile p { color: #adb5bd; font-size: 0.9rem; margin-bottom: 0; text-transform: capitalize; }

.status-normal { color: #198754; }
.status-light { color: #0dcaf0; }
.status-medium { color: #fd7e14; }
.status-strong { color: #dc3545; }
.status-warning { color: #dc3545; font-weight: bold; }
.status-unknown { color: #6c757d; }

@keyframes blinker { 50% { opacity: 0.5; } }
.blink { animation: blinker 1.5s linear infinite; color: #dc3545; }
.device-active { color: #198754; }
.device-inactive { color: #6c757d; }

.chart-container {
    position: relative;
    height: 400px;
    width: 100%;
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
}
.stat-value { font-size: 1.5rem; font-weight: 700; margin-top: 5px; }
.stat-label { font-size: 0.85rem; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; }
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <div class="user-profile">
        <!-- Avatar bác sĩ -->
        <img src="https://cdn-icons-png.flaticon.com/512/3774/3774299.png" alt="Avatar"> 
        <h5 id="userProfileName">Đang tải...</h5>
        <p id="userProfileRole">Bác sĩ</p>
    </div>

    <a href="#" class="nav-link active" data-tab="patients"><i class="bi bi-people-fill"></i> Danh sách bệnh nhân</a>
    <a href="#" class="nav-link" data-tab="health"><i class="bi bi-activity"></i> Theo dõi sức khỏe</a>
    <a href="#" class="nav-link" data-tab="alerts"><i class="bi bi-bell-fill"></i> Cảnh báo</a>
    <a href="#" class="nav-link" data-tab="profile"><i class="bi bi-person-circle"></i> Thông tin cá nhân</a>
    
    <div style="margin-top: auto; padding: 20px;">
        <button id="logoutBtn" class="btn btn-outline-light w-100"><i class="bi bi-box-arrow-right"></i> Đăng xuất</button>
    </div>
</div>

<div class="content">

    <!-- TAB: DANH SÁCH BỆNH NHÂN -->
    <div id="tab-patients" class="tab-content">
        <h3 class="mb-4 fw-bold text-dark">Quản lý bệnh nhân</h3>
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">#</th>
                                <th>Họ và tên</th>
                                <th>Email</th>
                                <th>Điện thoại</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="patients-table-body">
                            <!-- JS sẽ điền dữ liệu vào đây -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: THEO DÕI SỨC KHỎE (REALTIME) -->
    <div id="tab-health" class="tab-content d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark mb-0">Theo dõi sức khỏe</h3>
            <div class="d-flex align-items-center">
                <label class="me-2 fw-bold text-secondary">Chọn bệnh nhân:</label>
                <select id="select-patient" class="form-select shadow-sm border-primary" style="width: 250px;">
                    <option value="">-- Chọn bệnh nhân --</option>
                </select>
            </div>
        </div>

        <!-- Khu vực hiển thị dữ liệu (Ẩn khi chưa chọn bệnh nhân) -->
        <div id="health-dashboard" class="d-none">
            <!-- Hàng 1: Thông tin trạng thái -->
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card h-100 bg-white">
                        <div class="card-header bg-transparent border-0 pb-0">
                            <i class="bi bi-cpu text-primary me-2"></i>Phân tích AI
                        </div>
                        <div class="card-body d-flex flex-column justify-content-center align-items-center text-center py-4">
                            <div class="mb-2 text-muted small">Trạng thái hiện tại của BN</div>
                            <div id="patient_health_status" class="fs-3 fw-bold status-unknown">Chưa có dữ liệu</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-transparent border-0 pb-0 d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-hdd-network text-success me-2"></i>Thiết bị đo</span>
                            <span class="badge bg-light text-dark border" id="patient_device_serial">---</span>
                        </div>
                        <div class="card-body d-flex flex-column justify-content-center">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted">Kết nối:</span>
                                <span id="patient_device_status" class="fw-bold">...</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Hoạt động:</span>
                                <span id="patient_measuring_status" class="fw-bold device-inactive">...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hàng 2: Các chỉ số -->
            <div class="row g-3 mb-4">
                <div class="col-md-2 col-6"><div class="card h-100 text-center border-bottom border-3 border-danger"><div class="card-body p-3"><div class="stat-label">BPM</div><div id="bpm_val" class="stat-value text-danger">0</div></div></div></div>
                <div class="col-md-2 col-6"><div class="card h-100 text-center border-bottom border-3 border-info"><div class="card-body p-3"><div class="stat-label">IR</div><div id="ir_val" class="stat-value text-info">0</div></div></div></div>
                <div class="col-md-2 col-4"><div class="card h-100 text-center"><div class="card-body p-3"><div class="stat-label">Accel X</div><div id="accel_x_val" class="stat-value text-secondary">0</div></div></div></div>
                <div class="col-md-2 col-4"><div class="card h-100 text-center"><div class="card-body p-3"><div class="stat-label">Accel Y</div><div id="accel_y_val" class="stat-value text-secondary">0</div></div></div></div>
                <div class="col-md-2 col-4"><div class="card h-100 text-center"><div class="card-body p-3"><div class="stat-label">Accel Z</div><div id="accel_z_val" class="stat-value text-secondary">0</div></div></div></div>
                <div class="col-md-2 col-6"><div class="card h-100 text-center border-bottom border-3 border-primary"><div class="card-body p-3"><div class="stat-label">Lực tổng</div><div id="a_total_val" class="stat-value text-primary">0</div></div></div></div>
            </div>

            <!-- Hàng 3: Biểu đồ -->
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0 text-secondary"><i class="bi bi-graph-up me-2"></i>Biểu đồ nhịp tim Real-time</h5>
                        <select id="chart-range" class="form-select w-auto form-select-sm shadow-sm">
                            <option value="day">Real-time (20 điểm gần nhất)</option>
                            <option value="week">Trong tuần</option>
                            <option value="month">Trong tháng</option>
                        </select>
                    </div>
                    <div class="chart-container" style="box-shadow: none; border: 1px solid #f0f0f0;">
                        <canvas id="bpmChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Thông báo khi chưa chọn BN -->
        <div id="no-patient-selected" class="text-center py-5 text-muted">
            <i class="bi bi-person-bounding-box fs-1 d-block mb-3"></i>
            <h4>Vui lòng chọn bệnh nhân để xem dữ liệu</h4>
        </div>
    </div>

    <!-- TAB: CẢNH BÁO -->
    <div id="tab-alerts" class="tab-content d-none">
        <h3 class="mb-4 fw-bold text-dark">Cảnh báo từ bệnh nhân</h3>
        <div class="card">
            <div class="card-body p-0">
                <div id="alerts-table" class="list-group list-group-flush"></div>
            </div>
        </div>
    </div>

    <!-- TAB: HỒ SƠ BÁC SĨ -->
    <div id="tab-profile" class="tab-content d-none">
        <h3 class="mb-4 fw-bold text-dark">Hồ sơ bác sĩ</h3>
        <div class="card">
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-6 border-end">
                        <h5 class="text-primary mb-4">Thông tin cá nhân</h5>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Họ và tên</label><div class="col-sm-8 fw-bold" id="doc_full_name">...</div></div>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Email</label><div class="col-sm-8" id="doc_email">...</div></div>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Điện thoại</label><div class="col-sm-8" id="doc_phone_number">...</div></div>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Ngày sinh</label><div class="col-sm-8" id="doc_date_of_birth">...</div></div>
                    </div>
                    <div class="col-md-6 ps-md-5">
                        <h5 class="text-primary mb-4">Thông tin công tác</h5>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Chức danh</label><div class="col-sm-8 fw-bold" id="doc_title">...</div></div>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Chuyên khoa</label><div class="col-sm-8" id="doc_specialty">...</div></div>
                        <div class="mb-3 row"><label class="col-sm-4 text-muted">Địa chỉ</label><div class="col-sm-8" id="doc_address">...</div></div>
                    </div>
                </div>
                <div class="text-end mt-4 pt-3 border-top">
                    <button id="doc-change-pass-btn" class="btn btn-light me-2">Đổi mật khẩu</button>
                    <button id="doc-update-info-btn" class="btn btn-primary">Cập nhật hồ sơ</button>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- MODAL CẬP NHẬT BÁC SĨ -->
<div class="modal fade" id="updateDoctorInfoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Cập nhật hồ sơ</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
          <div class="mb-3"><label class="form-label">Họ và tên</label><input type="text" class="form-control" id="modalDocFullName"></div>
          <div class="mb-3"><label class="form-label">Số điện thoại</label><input type="text" class="form-control" id="modalDocPhone"></div>
          <div class="mb-3"><label class="form-label">Địa chỉ</label><input type="text" class="form-control" id="modalDocAddress"></div>
          <div class="mb-3"><label class="form-label">Ngày sinh</label><input type="date" class="form-control" id="modalDocDOB"></div>
          <div class="mb-3"><label class="form-label">Chức danh</label><input type="text" class="form-control" id="modalDocTitle"></div>
          <div class="mb-3"><label class="form-label">Chuyên khoa</label><input type="text" class="form-control" id="modalDocSpecialty"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" id="saveDoctorInfoBtn">Lưu</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL ĐỔI MẬT KHẨU (Chung) -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Đổi mật khẩu</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
          <div id="changePassMsg" class="alert d-none"></div>
          <div class="mb-3"><label class="form-label">Mật khẩu cũ</label><input type="password" class="form-control" id="modalOldPass"></div>
          <div class="mb-3"><label class="form-label">Mật khẩu mới</label><input type="password" class="form-control" id="modalNewPass"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-primary" id="saveNewPassBtn">Lưu</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Gọi file JS riêng cho bác sĩ -->
<script src="assets/js/doctor.js"></script>

</body>
</html>